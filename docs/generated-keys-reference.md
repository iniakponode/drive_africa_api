# Generated API Keys Reference

⚠️ **THIS FILE CONTAINS SENSITIVE CREDENTIALS - DELETE AFTER COPYING KEYS**

This file is automatically generated by the seeding scripts and contains all API keys created during the seeding process.

## File Location
```
/var/www/vhosts/safedriveafrica.com/api.safedriveafrica.com/api_keys_GENERATED.txt
```

## File Format

```
Safe Drive Africa API - Generated Keys
======================================================================
Generated: 2026-01-09 15:30:45.123456
⚠️  DELETE THIS FILE AFTER COPYING KEYS
======================================================================

Name: Admin
Role: admin
API Key: <secure-random-key>

Name: Researcher
Role: researcher
API Key: <secure-random-key>

Name: Fleet Manager - Lagos Ops
Role: fleet_manager
Fleet: 5564e348-99dc-4921-858e-d06887d33077
API Key: <secure-random-key>

Name: Driver - John Doe
Role: driver
Driver Profile: e1c3446f-ffbc-4b90-b5be-2d8d25869d31
API Key: <secure-random-key>
```

## Security Best Practices

### 1. Immediately After Generation
```bash
# Copy the file to a secure location
cp api_keys_GENERATED.txt ~/secure_backup/api_keys_$(date +%Y%m%d).txt
chmod 600 ~/secure_backup/api_keys_$(date +%Y%m%d).txt

# Or copy to your local machine
scp root@api.safedriveafrica.com:/var/www/.../api_keys_GENERATED.txt ~/Desktop/
```

### 2. Store Keys Securely
- **Production**: Use a password manager (1Password, LastPass, Bitwarden)
- **Development**: Store in `.env` files (never commit to git)
- **Team Distribution**: Use secure sharing tools (1Password Teams, AWS Secrets Manager)

### 3. Delete the File
```bash
# After copying keys, delete the file
rm api_keys_GENERATED.txt

# Verify deletion
ls -la api_keys_GENERATED.txt
# Should show: No such file or directory
```

### 4. Document Key Distribution

Create a secure record of who has which keys:

```
# Example secure key registry (store in password manager)
Role: admin
Assigned To: admin@safedriveafrica.com
Created: 2026-01-09
Key ID: bb33af69-a843-487c-bc53-5fd3dd22febb
Purpose: Full system administration

Role: fleet_manager
Assigned To: fleet.manager@company.com
Created: 2026-01-09
Fleet: Lagos Ops (5564e348-99dc-4921-858e-d06887d33077)
Key ID: 908600d2-3d0b-49c7-8bb8-a770171716fa
Purpose: Fleet monitoring and management
```

## Using the Generated Keys

### Test a Key
```bash
# Replace YOUR_KEY with actual key from the file
curl -H "X-API-Key: YOUR_KEY" \
     https://api.safedriveafrica.com/api/auth/me
```

### Add to Environment File
```bash
# For local development
echo "ADMIN_API_KEY=<your-admin-key>" >> .env.local

# For frontend
echo "VITE_API_KEY=<your-key>" >> .env.production
```

### Store in Password Manager
1. Open your password manager
2. Create entry: "Safe Drive Africa - Admin API Key"
3. Store key in password field
4. Add notes: role, created date, purpose
5. Share with team members as needed

## Key Rotation

If keys are compromised or need rotation:

### 1. Disable Old Key
```bash
curl -X PATCH https://api.safedriveafrica.com/api/admin/api-clients/{client_id} \
  -H "X-API-Key: YOUR_ADMIN_KEY" \
  -H "Content-Type: application/json" \
  -d '{"active": false}'
```

### 2. Create New Key
```bash
curl -X POST https://api.safedriveafrica.com/api/admin/api-clients/ \
  -H "X-API-Key: YOUR_ADMIN_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Admin - Rotated",
    "role": "admin",
    "active": true
  }'
```

### 3. Update Applications
- Update all services using the old key
- Test with new key
- Monitor for any failures
- Delete old key after 30 days

## Recovery

If you lose the generated keys file:

### You CANNOT Retrieve Keys
API keys are hashed in the database and cannot be recovered. You must:

1. **Disable Lost Keys** (if you have admin access)
2. **Create New Keys** using an existing admin key
3. **Update All Services** with new keys

### If You Lose Admin Access
If you lose all admin keys:

```bash
# Connect to production server
ssh root@api.safedriveafrica.com
cd /var/www/vhosts/safedriveafrica.com/api.safedriveafrica.com

# Generate new admin key directly in database
mysql -u dev2 -p drive_safe_db
```

```sql
-- Create emergency admin key
INSERT INTO api_client (id, name, role, api_key_hash, active, created_at)
VALUES (
  UUID_TO_BIN(UUID()),
  'Emergency Admin',
  'admin',
  SHA2('your-new-emergency-key-here', 256),
  1,
  NOW()
);
```

⚠️ **This should only be done as a last resort!**

## Automation

For CI/CD pipelines, store keys in GitHub Secrets or similar:

### GitHub Actions
```yaml
env:
  API_KEY: ${{ secrets.ADMIN_API_KEY }}

steps:
  - name: Test API
    run: |
      curl -H "X-API-Key: $API_KEY" \
           https://api.safedriveafrica.com/api/auth/me
```

### Docker
```bash
docker run -e API_KEY=$ADMIN_API_KEY myapp
```

## Audit Trail

Check API key usage:

```bash
# View all API clients
curl -H "X-API-Key: YOUR_ADMIN_KEY" \
     https://api.safedriveafrica.com/api/admin/api-clients/

# Check server logs for key usage
sudo journalctl -u safedriveapi-prod -f | grep "X-API-Key"
```

## Support

For issues with generated keys:
1. Check [docs/api-key-seeding.md](api-key-seeding.md)
2. Review server logs: `sudo journalctl -u safedriveapi-prod -f`
3. Re-run seeding if needed (it's idempotent)
4. Contact system administrator
